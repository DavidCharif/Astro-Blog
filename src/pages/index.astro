---
import BaseLayout from "../layouts/BaseLayout.astro";
import Greeting from "../components/Greeting.jsx";
import { getCollection } from "astro:content";
import BlogPost from "../components/BlogPost.astro";

import HomeArticles from "../components/HomeArticles";
const pageTitle = "Home Page";
const allPosts = await getCollection("posts");

let innerArray = [];
let outerArray = [];
// This is the function that creates a sub array of arrays with one array
for (let i = 0; i < allPosts.length; i++) {
  // This is the condition that checks if the inner array has 6 elements
  if (innerArray.length === 6) {
    // This is the statement that pushes the inner array to the outer array
    outerArray.push(innerArray);
    // This is the statement that resets the inner array
    innerArray = [];
  }
  // This is the statement that pushes the current element to the inner array
  innerArray.push(allPosts[i]);
}
// This is the final check that pushes the remaining inner array if it is not empty
if (innerArray.length > 0) {
  outerArray.push(innerArray);
}
// This is the statement that logs the outer array to the console
---

<style>
 article.blogPost.focus {
    border: 10px solid red;
}
</style>
<script>
  const container = document.getElementById("blogHome");
  let index = 0; // the current focused post index
  const elements = container?.querySelectorAll(".blogPost"); // an array of elements with data-slug attribute
  console.log('elements', elements)
  container?.addEventListener("wheel", (event) => {
    event.preventDefault(); // prevent the default scrolling
    if (event.deltaY > 0) {
      // scroll down
      index++; // increment the index
      if (elements && index >= elements.length) {
        // check the upper bound
        index = elements.length - 1; // set the index to the last post
      }
    } else {
      // scroll up
      index--; // decrement the index
      if (index < 0) {
        // check the lower bound
        index = 0; // set the index to the first post
      }
    }
    if (elements) {
      cleanClasses(elements)
      elements[index].classList.add('focus')
      elements[index].scrollIntoView({behavior: 'smooth', inline: 'center'}); // scroll the post into view
    }
  });

  function cleanClasses (elements : NodeListOf<Element>) : void {
    elements.forEach(element => {
      element.classList?.remove('focus')
    })
  }
</script>

<BaseLayout pageTitle={pageTitle}>
  <div class="blogHome" id="blogHome">
    {outerArray.map((array, i) => (
      <div class="post-container">
        {array.map((post) => (
          <BlogPost
            key={post.slug} // make sure to use a unique key for each post
            url={`/Astro-Blog/posts/${post.slug}`}
            title={post.data.title}
            image={post.data.image}
            description={post.data.description}
            data-slug={post.slug} // add a data-slug attribute and use the slug prop as the value
          />
        ))}
      </div>
    ))}
  </div>
</BaseLayout>
